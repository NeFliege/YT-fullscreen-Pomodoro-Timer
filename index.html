<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube Focus Player</title>

<style>
* { box-sizing: border-box; font-family: system-ui, sans-serif; }
body {
  margin: 0;
  background: radial-gradient(1200px 600px at 20% 10%, #2a2f3a, #0f1115);
  color: white;
  display: flex;
  justify-content: center;
  padding: 24px;
}
.app { width: 100%; max-width: 1100px; }

.input-bar {
  display: flex;
  gap: 8px;
  margin-bottom: 14px;
  background: rgba(255,255,255,.08);
  padding: 12px;
  border-radius: 14px;
}
.input-bar input {
  flex: 1;
  background: transparent;
  border: none;
  color: white;
  font-size: 14px;
}
.input-bar button {
  background: rgba(255,255,255,.18);
  border: none;
  color: white;
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
}

.player-container {
  position: relative;
  aspect-ratio: 16/9;
  background: black;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 25px 80px rgba(0,0,0,.6);
}

iframe { width: 100%; height: 100%; border: none; }

.overlay {
  position: absolute;
  z-index: 10;
  backdrop-filter: blur(10px);
  background: rgba(255,255,255,.14);
  padding: 10px;
  border-radius: 12px;
}

.timer-box { top: 16px; left: 16px; width: 160px; }
.controls-box { top: 16px; right: 16px; }

footer {
  margin-top: 14px;
  background: rgba(255,255,255,.06);
  padding: 12px;
  border-radius: 14px;
}

.stat-grid {
  display: grid;
  gap: 10px;
  margin-top: 12px;
  grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
}
.stat {
  background: rgba(255,255,255,.08);
  padding: 10px;
  border-radius: 12px;
}
</style>
</head>

<body>
<div class="app">

<div class="input-bar">
  <input id="urlInput" placeholder="Paste YouTube link">
  <button id="loadBtn">Load</button>
</div>

<div class="player-container">
  <div class="overlay timer-box">
    <div id="timerLabel">Focus</div>
    <div id="timerDisplay">25:00</div>
    <button onclick="toggleTimer()" id="timerBtn">Start</button>
    <button onclick="resetTimer()">Reset</button>
    <select id="modeSelect" onchange="changeMode()">
      <option value="pomodoro">Pomodoro</option>
      <option value="countdown">Countdown</option>
      <option value="countup">Count Up</option>
    </select>
  </div>

  <div class="overlay controls-box">
    <button onclick="enterFullscreen()">Fullscreen</button>
  </div>

  <div id="videoArea" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#888;">
    Paste link and press Load
  </div>
</div>

<footer>
  <div id="settingsPanel"></div>

  <div class="stat-grid">
    <div class="stat">Today: <span id="todayStat">0:00</span></div>
    <div class="stat">Week: <span id="weekStat">0:00</span></div>
    <div class="stat">Streak: <span id="streakStat">0 days</span></div>
  </div>
</footer>

<div id="historyList" style="margin-top:12px;"></div>

</div>

<script>
let mode = localStorage.getItem('mode') || 'pomodoro';
let pomodoro = JSON.parse(localStorage.getItem('pomodoro') || '{"focus":1500,"break":300}');
let running = false;
let secondsLeft = pomodoro.focus;
let countUpSeconds = 0;
let isBreak = false;
let sessionStart = null;

const chime = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQQAAAAA');

document.getElementById('modeSelect').value = mode;

function extractId(url) {
  const m = url.match(/([\w-]{11})/);
  return m ? m[1] : null;
}

document.getElementById('loadBtn').onclick = function() {
  const id = extractId(document.getElementById('urlInput').value);
  if (!id) return alert("Invalid link");

  const iframe = document.createElement('iframe');
  iframe.src = "https://www.youtube-nocookie.com/embed/" + id;
  iframe.allow = "autoplay; fullscreen";
  iframe.referrerPolicy = "strict-origin-when-cross-origin";

  const area = document.getElementById('videoArea');
  area.innerHTML = "";
  area.appendChild(iframe);
};

function enterFullscreen() {
  document.querySelector('.player-container').requestFullscreen();
}

function toggleTimer() {
  running = !running;
  document.getElementById('timerBtn').innerText = running ? "Pause" : "Start";
  if (running && !sessionStart) sessionStart = Date.now();
  if (!running && sessionStart) saveSession();
}

function resetTimer() {
  running = false;
  sessionStart = null;
  secondsLeft = pomodoro.focus;
  countUpSeconds = 0;
}

function changeMode() {
  mode = document.getElementById('modeSelect').value;
  localStorage.setItem('mode', mode);
  resetTimer();
  renderSettings();
}

function format(s) {
  const m = String(Math.floor(s/60)).padStart(2,'0');
  const sec = String(s%60).padStart(2,'0');
  return m+":"+sec;
}

setInterval(function() {
  if (!running) return;

  if (mode === 'countup') {
    countUpSeconds++;
  } else {
    secondsLeft--;
    if (secondsLeft <= 0) {
      running = false;
      chime.play();
    }
  }

  document.getElementById('timerDisplay').innerText =
    mode === 'countup' ? format(countUpSeconds) : format(secondsLeft);

},1000);

function saveSession() {
  const end = Date.now();
  const dur = Math.floor((end - sessionStart)/1000);
  if (dur < 5) return;

  const history = JSON.parse(localStorage.getItem('history') || '[]');
  history.unshift({ dur, date: new Date().toLocaleString() });
  localStorage.setItem('history', JSON.stringify(history.slice(0,50)));
}

function renderSettings() {
  const panel = document.getElementById('settingsPanel');
  if (mode === 'pomodoro') {
    panel.innerHTML = 'Focus <input id="f" type="number" value="'+pomodoro.focus/60+'"> Break <input id="b" type="number" value="'+pomodoro.break/60+'"> <button onclick="savePomo()">Save</button>';
  } else if (mode === 'countdown') {
    panel.innerHTML = 'Minutes <input id="c" type="number" value="25"> <button onclick="applyCountdown()">Apply</button>';
  } else {
    panel.innerHTML = 'Count-up has no settings';
  }
}

function savePomo() {
  pomodoro.focus = Number(document.getElementById('f').value)*60;
  pomodoro.break = Number(document.getElementById('b').value)*60;
  localStorage.setItem('pomodoro', JSON.stringify(pomodoro));
  resetTimer();
}

function applyCountdown() {
  secondsLeft = Number(document.getElementById('c').value)*60;
}

renderSettings();
</script>

</body>
</html>
